/* ========================================== Common JavaScript - Mobile-First The British Nanny's Website ========================================== */ (function() { 'use strict';function initMobileMenu() { const mobileToggle = document.querySelector('.mobile-menu-toggle');const mobileMenu = document.querySelector('.mobile-menu');const mobileOverlay = document.querySelector('.mobile-menu-overlay');const mobileClose = document.querySelector('.mobile-menu-close');const body = document.body;if (!mobileToggle || !mobileMenu || !mobileOverlay) return;if (mobileToggle.children.length === 0) { for (let i = 0;i < 3;i++) { const span = document.createElement('span');mobileToggle.appendChild(span);} } function toggleMobileMenu() { const isActive = mobileMenu.classList.contains('active');if (isActive) { closeMobileMenu();} else { openMobileMenu();} } function openMobileMenu() { mobileToggle.classList.add('active');mobileOverlay.style.display = 'block';mobileOverlay.offsetHeight;requestAnimationFrame(() => { mobileOverlay.classList.add('active');mobileMenu.classList.add('active');});body.style.overflow = 'hidden';updateActiveMenuItems();} function closeMobileMenu() { mobileToggle.classList.remove('active');mobileMenu.classList.remove('active');mobileOverlay.classList.remove('active');setTimeout(() => { if (!mobileOverlay.classList.contains('active')) { mobileOverlay.style.display = 'none';} }, 300);body.style.overflow = '';} function updateActiveMenuItems() { const currentHash = window.location.hash;const menuLinks = mobileMenu.querySelectorAll('nav a');menuLinks.forEach(link => { link.classList.remove('active');const href = link.getAttribute('href');if (href === currentHash || (currentHash === '' && href === '#hero') || (href.includes('index.html') && window.location.pathname.includes('index.html')) || (href.includes('potty-training-book.html') && window.location.pathname.includes('potty-training-book.html'))) { link.classList.add('active');} });} mobileToggle.addEventListener('click', toggleMobileMenu);if (mobileClose) { mobileClose.addEventListener('click', closeMobileMenu);} mobileOverlay.addEventListener('click', closeMobileMenu);const mobileLinks = mobileMenu.querySelectorAll('a');mobileLinks.forEach(link => { link.addEventListener('click', () => { setTimeout(closeMobileMenu, 100);});});document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && mobileMenu.classList.contains('active')) { closeMobileMenu();} });window.addEventListener('resize', () => { if (window.innerWidth > 768 && mobileMenu.classList.contains('active')) { closeMobileMenu();} });let scrollTimeout;window.addEventListener('scroll', () => { if (scrollTimeout) { window.cancelAnimationFrame(scrollTimeout);} scrollTimeout = window.requestAnimationFrame(() => { if (mobileMenu.classList.contains('active')) { updateActiveMenuItemsFromScroll();} });}, { passive:true });function updateActiveMenuItemsFromScroll() { const sections = document.querySelectorAll('section[id], .hero-book[id]');const menuLinks = mobileMenu.querySelectorAll('nav a[href^="#"]');const scrollPosition = window.scrollY + 100;let currentSection = '';sections.forEach(section => { const top = section.offsetTop;const height = section.offsetHeight;if (scrollPosition >= top && scrollPosition < top + height) { currentSection = '#' + section.id;} });menuLinks.forEach(link => { link.classList.remove('active');if (link.getAttribute('href') === currentSection) { link.classList.add('active');} });} } function initSmoothScrolling() { document.querySelectorAll('a[href^="#"]').forEach(anchor => { anchor.addEventListener('click', function (e) { const href = this.getAttribute('href');if (!href || href === '#') return;e.preventDefault();const target = document.querySelector(href);if (target) { const headerHeight = document.querySelector('.site-header')?.offsetHeight || 0;const offset = 20;const targetPosition = target.offsetTop - headerHeight - offset;window.scrollTo({ top:targetPosition, behavior:'smooth' });} });});} function initFAQAccordion() { const faqItems = document.querySelectorAll('.faq-item');faqItems.forEach(item => { const question = item.querySelector('.faq-question');const answer = item.querySelector('.faq-answer');if (!question || !answer) return;question.addEventListener('click', () => { const isActive = item.classList.contains('active');faqItems.forEach(otherItem => { if (otherItem !== item) { otherItem.classList.remove('active');} });item.classList.toggle('active', !isActive);});question.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault();question.click();} });question.setAttribute('tabindex', '0');question.setAttribute('aria-expanded', 'false');question.setAttribute('role', 'button');const observer = new MutationObserver(() => { const isExpanded = item.classList.contains('active');question.setAttribute('aria-expanded', isExpanded.toString());});observer.observe(item, { attributes:true, attributeFilter:['class'] });});} function initFormEnhancements() { const forms = document.querySelectorAll('form');forms.forEach(form => { form.addEventListener('submit', function() { const submitBtn = form.querySelector('button[type="submit"], input[type="submit"]');if (submitBtn) { submitBtn.disabled = true;submitBtn.textContent = 'Sending...';submitBtn.classList.add('loading');} });const inputs = form.querySelectorAll('input, textarea, select');inputs.forEach(input => { input.addEventListener('blur', validateInput);input.addEventListener('input', clearValidation);});});function validateInput(e) { const input = e.target;const value = input.value.trim();input.classList.remove('valid', 'invalid');if (input.hasAttribute('required') && !value) { input.classList.add('invalid');return false;} if (input.type === 'email' && value) { const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;if (!emailRegex.test(value)) { input.classList.add('invalid');return false;} } if (input.type === 'tel' && value) { const phoneRegex = /^[\+]?[0-9\s\-\(\)]{10,}$/;if (!phoneRegex.test(value)) { input.classList.add('invalid');return false;} } if (value) { input.classList.add('valid');} return true;} function clearValidation(e) { const input = e.target;input.classList.remove('invalid');} } function initLoadingAnimations() { const animatedElements = document.querySelectorAll('.card, .service-card, .testimonial-card, .content-card, .review-card');const observer = new IntersectionObserver((entries) => { entries.forEach(entry => { if (entry.isIntersecting) { entry.target.style.opacity = '1';entry.target.style.transform = 'translateY(0)';} });}, { threshold:0.1, rootMargin:'0px 0px -50px 0px' });animatedElements.forEach(el => { el.style.opacity = '0';el.style.transform = 'translateY(20px)';el.style.transition = 'opacity 0.6s ease, transform 0.6s ease';observer.observe(el);});} function initTouchEnhancements() { const touchElements = document.querySelectorAll('.btn, .card, .service-card, .testimonial-card, .faq-question');touchElements.forEach(el => { el.addEventListener('touchstart', function() { this.style.transform = 'scale(0.98)';}, { passive:true });el.addEventListener('touchend', function() { this.style.transform = '';}, { passive:true });el.addEventListener('touchcancel', function() { this.style.transform = '';}, { passive:true });});if (window.innerWidth < 768) { const smallTargets = document.querySelectorAll('a, button');smallTargets.forEach(target => { const rect = target.getBoundingClientRect();if (rect.height < 44) { target.style.minHeight = '44px';target.style.display = 'flex';target.style.alignItems = 'center';target.style.justifyContent = 'center';} });} } function initPerformanceOptimizations() { const images = document.querySelectorAll('img[data-src]');const imageObserver = new IntersectionObserver((entries) => { entries.forEach(entry => { if (entry.isIntersecting) { const img = entry.target;img.src = img.dataset.src;img.removeAttribute('data-src');imageObserver.unobserve(img);} });});images.forEach(img => imageObserver.observe(img));if (window.innerWidth < 768) { const preloadLinks = [ 'assets/css/style.css', 'assets/css/daycare.css', 'assets/css/book.css' ];preloadLinks.forEach(href => { const link = document.createElement('link');link.rel = 'preload';link.as = 'style';link.href = href;document.head.appendChild(link);});} } function initAccessibilityEnhancements() { const skipLink = document.createElement('a');skipLink.href = '#main-content';skipLink.className = 'skip-to-content';skipLink.textContent = 'Skip to main content';document.body.insertBefore(skipLink, document.body.firstChild);const mainContent = document.querySelector('main') || document.querySelector('.hero, .hero-book');if (mainContent && !mainContent.id) { mainContent.id = 'main-content';} document.addEventListener('keydown', (e) => { if (e.key === 'Tab') { document.body.classList.add('keyboard-navigation');} });document.addEventListener('mousedown', () => { document.body.classList.remove('keyboard-navigation');});const announcer = document.createElement('div');announcer.setAttribute('aria-live', 'polite');announcer.setAttribute('aria-atomic', 'true');announcer.className = 'sr-only';announcer.id = 'announcer';document.body.appendChild(announcer);} function debounce(func, wait) { let timeout;return function executedFunction(...args) { const later = () => { clearTimeout(timeout);func(...args);};clearTimeout(timeout);timeout = setTimeout(later, wait);};} function throttle(func, limit) { let inThrottle;return function() { const args = arguments;const context = this;if (!inThrottle) { func.apply(context, args);inThrottle = true;setTimeout(() => inThrottle = false, limit);} } } function init() { initMobileMenu();initSmoothScrolling();initFAQAccordion();initFormEnhancements();initTouchEnhancements();initAccessibilityEnhancements();if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', () => { initLoadingAnimations();initPerformanceOptimizations();});} else { initLoadingAnimations();initPerformanceOptimizations();} window.addEventListener('orientationchange', debounce(() => { const mobileMenu = document.querySelector('.mobile-menu');if (mobileMenu && mobileMenu.classList.contains('active')) { mobileMenu.classList.remove('active');document.querySelector('.mobile-menu-overlay').classList.remove('active');document.querySelector('.mobile-menu-toggle').classList.remove('active');document.body.style.overflow = '';} }, 250));if ('performance' in window) { window.addEventListener('load', () => { const perfData = performance.getEntriesByType('navigation')[0];if (perfData) { console.log('Page load time:', perfData.loadEventEnd - perfData.loadEventStart, 'ms');} });} } if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', init);} else { init();} if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') { window.BritishNannyCommon = { initMobileMenu, initSmoothScrolling, initFAQAccordion, debounce, throttle };} })();